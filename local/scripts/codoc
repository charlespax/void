#!/usr/bin/env bash

# Notes #######################################################################
# The original command alias for vimdoc, the predacessor for codoc
# - All flag arguments must come before the command. The first unflagged
#   argument defines COMMAND. All proceeding arguments will be ignored.j w
#
# TODO ~/.config/codoc  # list of files that codoc should be aware of
# TODO in codoc, allow for execution in dmenu or terminal
# TODO codoc tag can be specified directly within the file, overrides default
# TODO codoc tag specifically for notes specified in file, --notes activates
# TODO find all codoc files in a specified directory

# Header Information ##########################################################
#
# Name: System Dope codoc in-line documentation viewer

# Script Metadata and Constants ###############################################
SCRIPT_NAME="codoc"
SCRIPT_VERSION="0.0.1"
SCRIPT_LICENSE="gplv3"
DOPE_VERSION="0.0.1"

# Global Varaibles ############################################################
CODOC_TAG='CODOC'
COMMAND=""
TARGET_FILE=""

# Usage #######################################################################
USAGE="Usage: ${SCRIPT_NAME} [OPTION]... [COMMAND]...
In-line documentation viewer
Example ${SCRIPT_NAME} vim

Commands:

Flags:
  -f, --file=TARGET_FILE  define TARGET_FILE
  -h, --help              print this help message
  -t, --tag=CODOC_TAG     define CODOC_TAG
  -v, --version           print this script's name and version\n"

# Argument Processing #########################################################
if [[ $# == 0 ]]; then
	printf "${USAGE}"
	exit
fi
while [[ $# -gt 0 ]]; do
	case "${1}" in
	# Flag Arguments
		-f|--file)
			shift
			TARGET_FILE="${1}"
			shift
			;;
		-h|--help)
			printf "${USAGE}\n"
			exit
			;;
		-t|--tag)
			shift
			CODOC_TAG="${1}"
			shift
			;;
		-v|--version)
			printf "${SCRIPT_NAME} ${SCRIPT_VERSION}\n"
			exit
			;;
		-*)
			printf "Unknown flag: ${1}\n"
			exit
			;;
	# Non-flag Arguments
		# The first non-flag argument defined COMMAND
		*)
			COMMAND="${1}"
			shift
			;;
	esac
done

# Function Declarations #######################################################
function printlines {
	TARGET_FILE="${1}"
	grep "${CODOC_TAG}" "${TARGET_FILE}" | sed 's/^.'*$CODOC_TAG'//g'
}

# Main Program Logic ##########################################################

case "${COMMAND}" in
	"bash") # COODOOC bash
		TARGET_FILE=~/.bashrc
		;;
	"codoc") # COODOOC codoc
		CODOC_TAG='COOD'
		CODOC_TAG+='OOC'
		TARGET_FILE=~/.local/scripts/codoc
		;;
	"sdiwctl") # COODOOC sdiwctl
		TARGET_FILE=~/.local/scripts/sdiwctl
		;;
	"vim") # COODOOC vim
		TARGET_FILE=~/.config/vim/vimrc
		;;
	*)
		printf "Unknown command: ${COMMAND}\n"
		exit
		;;
esac

printlines "${TARGET_FILE}"
